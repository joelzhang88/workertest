name: Auto-create branches (master, develop, staging)

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  ensure_branches_exist:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout default branch
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Set up Git
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"

      - name: Ensure branches exist
        env:
          REPO: https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
        run: |
          TARGET_BRANCHES=("master" "develop" "staging")

          for BRANCH in "${TARGET_BRANCHES[@]}"; do
            if git ls-remote --heads origin $BRANCH > /dev/null 2>&1; then
              echo "Branch '$BRANCH' exists."
            else
              echo "Creating '$BRANCH' from 'main' ..."
              git checkout -b $BRANCH main
              git push $REPO $BRANCH
              echo "Created '$BRANCH'"
            fi
          done

