name: Auto-create branches (master, develop, staging)

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  ensure_branches_exist:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout default branch
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Set up Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Ensure branches exist
        run: |
          TARGET_BRANCHES=("master" "develop" "staging")

          for BRANCH in "${TARGET_BRANCHES[@]}"; do
            if git ls-remote --exit-code --heads origin $BRANCH > /dev/null 2>&1; then
              echo "Branch '$BRANCH' already exists â€” skipping creation."
            else
              echo "Branch '$BRANCH' does not exist. Creating now."
              git checkout -b $BRANCH main
              git push origin $BRANCH
            fi
          done
